<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>王星个人网站</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="css/mui.min.css">
    <link rel="stylesheet" href="css/newIndex.css">
    <script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="js/mui.min.js"></script>
    <script type="text/javascript" src="js/icon.js"></script>
</head>
<style>
    .listItem{
        margin-right: -100px;
    }
    .listItem-img{
        max-width:150px !important;
        height: 100px !important;
    }
    .listItem-divImg{
        height: 100px !important;
        width: 250px !important;
        max-width:150px !important;
        background-size: auto 100%;
        background-position: center;
    }
    .mui-table-view-cell {
        margin-right: -5px;
    }
    .mui-table-view-cell>a:not(.mui-btn) {
        margin: -11px -15px -11px -20px;
        white-space: normal;
    }
    .mui-table-view-chevron .mui-table-view-cell>a:not(.mui-btn) {
        margin-right: -100px;
    }
    .mui-navigate-right:after, .mui-push-right:after {
        right: 45px;
    }
    .listItem-body{
        white-space: nowrap;
        text-overflow: ellipsis;
        font-size: 16px;
        line-height: 30px;
    }
    .listItem-p{
        -webkit-box-orient: vertical;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        text-overflow: ellipsis;
        overflow: hidden;
        font-size: 12px;
        line-height: 22px;
        white-space: normal;
        text-overflow: ellipsis;
    }
</style>
<body>
<div id="offCanvasWrapper" class="mui-off-canvas-wrap mui-draggable">
    <!--侧滑菜单部分-->
    <aside id="offCanvasSide" class="mui-off-canvas-left">
        <div id="offCanvasSideScroll" class="mui-scroll-wrapper">
            <div class="title">
                <img src="img/favicon.ico"/>
                <span style="color: #ffffff">王星个人网站</span>
            </div>
            <div class="content">
                <ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted">
                    <li class="mui-table-view-cell mui-collapse"><a class="mui-navigate-right">About me</a>
                        <ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted">
                            <li class="mui-table-view-cell"><a class="mui-navigate-right" href="#" onclick="window.location.href = 'aboutMe.html'">关于我</a>
                            </li>
                            <!--<li class="mui-table-view-cell"><a class="mui-navigate-right" href="#" onclick="window.location.href = 'myExperience.html'">我的经历</a>
                            </li>-->
                        </ul>
                    </li>
                    <li class="mui-table-view-cell mui-collapse"><a class="mui-navigate-right" href="#">我的项目</a>
                        <ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted">
                            <li class="mui-table-view-cell"><a class="mui-navigate-right" onclick="window.location.href = 'http://iwangxing.cn/joke/joke.html'" >笑话大全</a>
                            </li>
                            <li class="mui-table-view-cell"><a class="mui-navigate-right" onclick="window.location.href = 'http://iwangxing.cn/webAPP/app_mobile.html'" >webAPP阅读器模块</a>
                            </li>
                            <li class="mui-table-view-cell"><a class="mui-navigate-right" onclick="window.location.href = 'https://iwangxing.cn/2048/2048.html'" >2048小游戏</a>
                            </li>
                            <li class="mui-table-view-cell"><a class="mui-navigate-right" onclick="window.location.href = 'https://iwangxing.cn/@Media/src/index.html'" >响应式首页</a>
                            </li>
                            <li class="mui-table-view-cell"><a class="mui-navigate-right" onclick="window.location.href = 'http://iwangxing.cn/xianlvyou/xian.html'" >西安旅游网</a>
                            </li>
                            <li class="mui-table-view-cell"><a class="mui-navigate-right" onclick="window.location.href = 'http://iwangxing.cn/canvas-clock/clock.html'">clock</a>
                            </li>
                        </ul>
                    </li>
                    <li class="mui-table-view-cell mui-collapse"><a class="mui-navigate-right" href="#">我的博客</a>
                        <ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted">
                            <li class="mui-table-view-cell">
                                <a class="mui-navigate-right" onclick="window.location.href = 'readingList.html?frontEnd'">
                                    前端
                                    <!--<span class="mui-badge mui-badge-success">123</span>-->
                                </a>
                            </li>

                        </ul>
                    </li>
                    <li class="mui-table-view-cell mui-collapse"><a class="mui-navigate-right" href="#">我的爱好</a>
                        <ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted">
                            <li class="mui-table-view-cell">
                                <a class="mui-navigate-right" onclick="window.location.href = 'readingList.html?book'">
                                    读书
                                    <!-- <span class="mui-badge mui-badge-success">3</span>-->
                                </a>
                            </li>
                            <li class="mui-table-view-cell">
                                <a class="mui-navigate-right" onclick="window.location.href = 'readingList.html?movie'">
                                    电影
                                    <!--<span class="mui-badge mui-badge-success">123</span>-->
                                </a>
                            </li>
                            <li class="mui-table-view-cell">
                                <a class="mui-navigate-right" onclick="window.location.href = 'readingList.html?sport'">
                                    体育
                                    <!--<span class="mui-badge mui-badge-success">123</span>-->
                                </a>
                            </li>
                            <li class="mui-table-view-cell">
                                <a class="mui-navigate-right" onclick="window.location.href =  'readingList.html?travel'">
                                    旅游
                                    <!--<span class="mui-badge mui-badge-success">123</span>-->
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
                <p style="margin: 10px 15px;">
                    <button id="offCanvasHide" type="button" class="mui-btn mui-btn-danger mui-btn-block" style="padding: 5px 20px;margin-top: 30px;">关闭</button>
                </p>

            </div>
        </div>
    </aside>
    <!--主界面部分-->
    <div class="mui-inner-wrap main-content">
        <div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper">
            <header class="mui-bar mui-bar-nav">
                <a id="goBack" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
                <h1 class="mui-title" id="mainTitle">阅读</h1>
            </header>
            <div class="mui-scroll" id="pullrefresh">

                <div class="mui-content" id="mui-main-content" style="margin-bottom: 50px;">
                </div>
            </div>
        </div>
        <div class="mui-off-canvas-backdrop"></div>
    </div>
</div>
</body>
<script>
    //初始化，设定上拉刷新，下拉加载
    mui.init({
        pullRefresh: {
            container: '#pullrefresh',
            down: {
                callback: pulldownRefresh
            },
            up: {
                contentrefresh: '正在加载...',
                callback: pullupRefresh
            }
        }
    });
    var thisURL = document.URL;
    var type =thisURL.split('?')[1];
    var url,allNum,arrList,num;
    var nowCount=0;//计数器
    var pageSize=5;
    $(function () {
        getBase();
        /*获取书的id*/
         /*$.ajax({
         url: "https://api.douban.com/v2/book/isbn/9787221058041",
         type: 'GET',
         dataType: 'JSONP',
         success: function (data) {
         console.log(data);
         },
         fail:function (error) {
         console.log(error);
         }
         });*/
         /*获取电影ID*/
       /*$.ajax({
            url: "https://api.douban.com/v2/movie/search?q=一条狗的使命",
            type: 'GET',
            dataType: 'JSONP',
            success: function (data) {
                console.log(data);
            },
            fail:function (error) {
                console.log(error);
            }
        });*/
    });
    function getBase(){
        if(type=="book"){
            $("#mainTitle").text("我的书单");
            allNum=data[1].length;
            localStorage.setItem(item[1],allNum);
            arrList=data[1];
            url="https://api.douban.com/v2/book/isbn/";
            getList();
        }else if(type=="movie"){
            $("#mainTitle").text("我的影单");
            allNum=data[0].length;
            localStorage.setItem(item[0],allNum);
            arrList=data[0];
            url="https://api.douban.com/v2/movie/subject/";
            getList();
        }else if(type=="sport"){
            $("#mainTitle").text("体育");
            allNum=data[2].length;
            localStorage.setItem(item[2],allNum);
            arrList=data[2];
            getList();
        }else if(type=="travel"){
            $("#mainTitle").text("旅行");
            allNum=data[3].length;
            localStorage.setItem(item[3],allNum);
            arrList=data[3];
            getList();
        }else if(type=="frontEnd"){
            $("#mainTitle").text("前端");
            allNum=data[4].length;
            localStorage.setItem(item[4],allNum);
            arrList=data[4];
            getList();
        }
    }
    function getList() {
        num=(allNum-nowCount<5)?(allNum-nowCount):5;
        if(type=="book"||type=="movie"){
            for(var i=0;i<num;i++){
                appendNetHtml();
                nowCount++;
            }
        }else{
            for(var i=0;i<num;i++){
                appendLocalHtml();
                nowCount++;
            }
        }
    }
    function appendLocalHtml(){
        var strHtml='';
        strHtml+='<ul class="mui-table-view mui-table-view-chevron" style="margin-top: 10px" onclick="window.location.href = \'readingDetail.html?'+type+'?'+nowCount+'\'">';
        strHtml+='<li class="mui-table-view-cell mui-media">';
        strHtml+='<a class="mui-navigate-right listItem">';
        strHtml+='<div class="mui-media-object mui-pull-left listItem-divImg" style="background-image: url(\''+arrList[nowCount].image+'\')"></div>';
        strHtml+='<div class="mui-media-body listItem-body">'+arrList[nowCount].title;
        strHtml+='<p class="mui-ellipsis  listItem-p">'+arrList[nowCount].summary+'</p>';
        strHtml+='</div></a></li></ul>';
        $("#mui-main-content").append(strHtml);
    }
    function appendNetHtml() {
        $.ajax({
            url: url+arrList[nowCount],
            type: 'GET',
            dataType: 'JSONP',
            success: function (data) {
                var strHtml='';
                strHtml+='<ul class="mui-table-view mui-table-view-chevron" style="margin-top: 10px" onclick="window.location.href = \'readingDetail.html?'+type+'?'+nowCount+'\'">';
                strHtml+='<li class="mui-table-view-cell mui-media">';
                strHtml+='<a class="mui-navigate-right listItem">';
                var thisImage;
                if(type=="book"){
                    thisImage=data.image;
                }else if(type=="movie"){
                    thisImage=data.images.medium;
                }
                strHtml+='<img class="mui-media-object mui-pull-left listItem-img" src="'+thisImage+'">';
                strHtml+='<div class="mui-media-body listItem-body">'+data.title;
                strHtml+='<p class="mui-ellipsis  listItem-p">'+data.summary+'</p>';
                strHtml+='</div></a></li></ul>';
                $("#mui-main-content").append(strHtml);
            },
            fail:function (error) {
                console.log(error);
            }
        });
    }
    function pulldownRefresh() {
        setTimeout(function() {
            var oldNum=localStorage.getItem(type+"Num");
            if(oldNum!=allNum){
                getBase();
            }else{
                mui.toast("暂无数据更新！");
            }
            mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
        }, 1500);

    }
    function pullupRefresh() {
        setTimeout(function() {
            mui('#pullrefresh').pullRefresh().endPullupToRefresh((allNum==nowCount)); //参数为true代表没有更多数据了。
            getBase();
        }, 1500);
    }
</script>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="js/data.js"></script>
</html>